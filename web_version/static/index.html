<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>学业基础分计算工具</title>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="static/layui/css/layui.css" media="all">
    <script src="static/layui/layui.js" charset="utf-8"></script>
    <style type="text/css">
        .layui-form-label{
            width: 100px;
        }
        .layui-input-block{
            margin-left: 130px;
        }
    </style>
</head>

<body>
    <ul class="layui-nav" lay-filter="">
        <li class="layui-nav-item layui-this">学业基础分计算工具</li>
    </ul>

    <div style="margin: 15px">
        <blockquote class="layui-elem-quote layui-text">
            如果使用奕报告截图识别，请注意核对成绩<br>
            本计算工具不会保存任何信息
        </blockquote>

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>奕报告截图识别（可选）</legend>
        </fieldset>

        <div style="width: 50%; margin: 0 auto;">
            <button type="button" class="layui-btn layui-btn-fluid" id="upload">
                <i class="layui-icon">&#xe67c;</i>上传截图
            </button>
        </div>


        <div class="layui-form">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>第一学期成绩</legend>
            </fieldset>
            <div class="layui-form-item">
                <label class="layui-form-label">无线射频识别技术与应用<div name="credit">绩点：4.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="无线射频识别技术与应用" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">数字图像处理<div name="credit">绩点：2.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="数字图像处理" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">软件工程<div name="credit">绩点：3.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="软件工程" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">Web应用开发<div name="credit">绩点：3.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="Web应用开发" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">嵌入式系统及应用<div name="credit">绩点：4.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="嵌入式系统及应用" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">嵌入式系统实训<div name="credit">绩点：2.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="嵌入式系统实训" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">毛泽东思想和中国特色社会主义理论体系概论<div name="credit">绩点：3.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="毛泽东思想和中国特色社会主义理论体系概论" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">移动终端开发技术<div name="credit">绩点：3.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="移动终端开发技术" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
        </div>

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>第二学期成绩</legend>
        </fieldset>
        <div class="layui-form">
            <div class="layui-form-item">
                <label class="layui-form-label">Web应用开发实训<div name="credit">绩点：2.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="Web应用开发实训" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ZigBee通信协议与应用<div name="credit">绩点：4.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="ZigBee通信协议与应用" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">专业英语<div name="credit">绩点：2.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="专业英语" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">信息安全技术<div name="credit">绩点：3.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="信息安全技术" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">无线传感器网络技术<div name="credit">绩点：4.0</div></label>
                <div class="layui-input-block">
                    <input type="number" id="无线传感器网络技术" name="grade" autocomplete="off" placeholder="请输入成绩"
                        class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" id="calc">计算基础分</button>
                <button onclick="reset()" class="layui-btn layui-btn-primary">清空</button>
            </div>
        </div>

        <script type="text/javascript">
            layui.use('layer', function () {
                var $ = layui.jquery, layer = layui.layer;
                layer.open({
                    offset: 'auto',
                    title: '注意',
                    content: "如果使用奕报告截图识别，请注意核对成绩"
                })
                $('#calc').click(function () {
                    var jds = document.getElementsByName("credit");
                    var cjs = document.getElementsByName("grade");
                    var sum = 0;
                    var jdSum = 0;
                    var jbf = 0;
                    for (var i = 0; i < jds.length; i++) {
                        var jd = jds[i].innerText.split("：");
                        var cj = cjs[i].value;
                        if (cj === '' || cj === null) {
                            layer.msg('请输入全部成绩信息');
                            return;
                        }
                        jdSum += parseFloat(jd[1]);
                        sum += parseFloat(jd[1]) * parseFloat(cj);
                        console.log(jdSum + ' ' + sum);
                    }
                    jbf = (sum / jdSum) * 0.8;

                    layer.open({
                        content: '基础分：' + jbf.toFixed(2)
                    })
                })
            });
            function setGrade(json) {
                for (var key in json) {
                    $('#' + key).val(json[key]);
                }
            }
            function reset() {
                $(" input[ name='grade' ] ").val("")
            }
            layui.use('upload', function () {
                var upload = layui.upload;

                //执行实例
                var uploadInst = upload.render({
                    elem: '#upload' //绑定元素
                    , url: '/getgrades' //上传接口
                    , done: function (res) {
                        if (JSON.stringify(res) == "{}") {
                            layer.msg('请上传正确的奕报告截图');
                        } else {
                            setGrade(res);
                            layer.msg('识别成功,注意核对成绩');
                        }
                    }
                    , error: function () {
                        layer.msg('上传出现错误');
                    }
                });
            });
        </script>

</body>

</html>